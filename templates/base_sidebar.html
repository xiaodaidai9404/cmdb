{% load staticfiles %}
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar" style="z-index: 98">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
      <!-- Sidebar user panel -->
      <div class="user-panel">
        <div class="pull-left image">
          <img src="{% static "dist/img/user2-160x160.jpg" %}" class="img-circle" alt="User Image">
        </div>
        <div class="pull-left info">
          <p>{{request.user.username}}</p>
          <a href="#"><i class="fa fa-circle text-success"></i> {{request.user.username}}</a>
        </div>
      </div>
      <!-- search form -->
      <form action="#" method="get" class="sidebar-form">
        <div class="input-group">
          <input type="text" name="q" class="form-control" placeholder="Search...">
          <span class="input-group-btn">
            <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i></button>
          </span>
        </div>
      </form>
      <!-- /.search form -->
      <!-- sidebar menu: : style can be found in sidebar.less -->
      <ul class="sidebar-menu">
        <li class="header">MAIN NAVIGATION</li>

        <li id="servicedeskmenu" class="treeview">
          <a href="/">
            <i class="fa fa-dashboard"></i> <span>首页</span>
          </a>
        </li>
{#        {% if perms.server.can_server_url %}#}
        <li id="server" class="treeview">
            <a href="#">
                <i class="fa fa-key"></i>
                <span>服务器查看</span>
                <span class="label label-primary pull-right">0</span>
            </a>
            <ul class="treeview-menu">
                <li id="servercheck"><a href="/server_info/"><i class="fa fa-circle-o"></i>服务器信息</a>
                <li id="servercheck"><a href="/server_load_info/"><i class="fa fa-circle-o"></i>服务器负载</a>
                </li>
            </ul>
        </li>
        <li id="server" class="treeview">
            <a href="#">
                <i class="fa fa-key"></i>
                <span>数据库代理信息</span>
                <span class="label label-primary pull-right">0</span>
            </a>
            <ul class="treeview-menu">
                <li id="routercheck"><a href="/router_info_html"><i class="fa fa-circle-o"></i>数据库代理信息</a>
                </li>
            </ul>
        </li>        
{#        {% endif %}#}
        {% if perms.soft.can_soft_url %}
       <li id="domain" class="treeview">
            <a href="#">
                <i class="fa fa-key"></i>
                <span>技术栈</span>
                <span class="label label-primary pull-right">0</span>
            </a>
            <ul class="treeview-menu">
                <li id="domain_name"><a href="/tech/stack/"><i class="fa fa-circle-o"></i>技术栈</a>
                </li>
            </ul>
        </li>
        {% endif %}
      {% if perms.env.can_env_url %}
          <li id="TestEnv" class="treeview">
            <a href="#">
                <i class="fa fa-key"></i>
                <span>测试环境</span>
                <span class="label label-primary pull-right">0</span>
            </a>
            <ul class="treeview-menu">
                <li id="domain_name"><a href="/env/test/"><i class="fa fa-circle-o"></i>测试环境</a>
                </li>
            </ul>
        </li>
      {% endif %}
      <li id="domain" class="treeview">
            <a href="#">
                <i class="glyphicon glyphicon-user"></i>
                <span>域名</span>
                <span class="label label-primary pull-right">0</span>
            </a>
            <ul class="treeview-menu">
                <li id="mysql_name"><a href="/domain_info/"><i class="fa fa-circle-o"></i>域名证书信息</a>
                </li>
            </ul>
      </li>
{#      {% if perms.im.can_im_url %}#}
{#                <li id="im_update" class="treeview">#}
{#            <a href="#">#}
{#                <i class="fa fa-key"></i>#}
{#                <span>IM升级</span>#}
{#                <span class="label label-primary pull-right">0</span>#}
{#            </a>#}
{#            <ul class="treeview-menu">#}
{#                <li id="domain_name"><a href="/im_server_info/"><i class="fa fa-circle-o"></i>IM升级</a>#}
{#                </li>#}
{#            </ul>#}
{#        </li>#}
{#      {% endif %}#}
      <li id="mysql" class="treeview">
            <a href="#">
                <i class="glyphicon glyphicon-user"></i>
                <span>mysql分表生成</span>
                <span class="label label-primary pull-right">0</span>
            </a>
            <ul class="treeview-menu">
                <li id="mysql_name"><a href="/mysql/submeter/"><i class="fa fa-circle-o"></i>mysql生成分表</a>
                </li>
            </ul>
	    <ul class="treeview-menu">
                <li id="syncdb"><a href="/syncdb_list/"><i class="fa fa-circle-o"></i>mysql数据库同步</a>
                </li>
            </ul>
      </li>
      <li id="celeryadmin" {% if nav_celery %} class="active treeview" {% else %} class="treeview" {% endif %}>
            <a href="#">
                <i class="glyphicon glyphicon-user"></i>
                <span>任务管理</span>
                <span class="label label-primary pull-right">0</span>
            </a>
            <ul class="treeview-menu">
                <li id="mysql_name"><a href="{% url 'periodictask_list' %}"><i class="fa fa-circle-o"></i>定时任务管理</a>
                </li>
            </ul>
            <ul class="treeview-menu">
                <li id="syncdb"><a href="{% url 'crontab_list' %}"><i class="fa fa-circle-o"></i>crontab管理</a>
                </li>
            </ul>
            <ul class="treeview-menu">
                <li id="syncdb"><a href="{% url 'interval_list' %}"><i class="fa fa-circle-o"></i>interval管理</a>
                </li>
            </ul>
      </li>
      {% if perms.auth.can_auth_url %}
        <li id="domain" class="treeview">
            <a href="#">
                <i class="glyphicon glyphicon-user"></i>
                <span>用户权限管理</span>
                <span class="label label-primary pull-right">0</span>
            </a>
            <ul class="treeview-menu">
                <li id="domain_name"><a href="/user/manager/"><i class="fa fa-circle-o"></i>用户管理</a>
                </li>
            </ul>
        </li>
      {% endif %}
      </ul>
    </section>
    <!-- /.sidebar -->
  </aside>
<script>
    $(function () {
        var menu_list = $("aside.main-sidebar .sidebar-menu").find('.treeview');
        for(var i=0; i<menu_list.length; i++){
            var menu = $(menu_list[i]);
            var num_label = menu.find('a span.label');
            if(num_label.length>0){
                var sub_menu_num = menu.find('ul.treeview-menu li').length;
                num_label.html(sub_menu_num);
            }
        }
        $(".hide_js").hide();
    })
</script>
